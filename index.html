<!DOCTYPE html>
<html lang="th">

<head>
    Â  Â 
    <meta charset="UTF-8">
    Â  Â 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title_header_lo">ğŸ’µ àº¥àº°àºšàº»àºšà»àº¥àºàº›à»ˆàº½àº™àºàº²àºà»ƒàº™àº®à»‰àº²àº™ - àº™àº²àº‡àº›àº²àºŠà»‰àº­àºàºŠàº»à»ˆàº‡</title>

    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    Â  Â 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    Â  Â  <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f4f4f4;
        }

        body.dark {
            background: #121212;
            color: #e0e0e0;
        }

        body.dark .container {
            background: #1e1e1e;
            color: #e0e0e0;
        }

        body.dark nav {
            background: #1f1f1f;
        }

        body.dark nav button {
            background: #2c2c2c;
        }

        header {
            background: #007bff;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 24px;
        }

        nav {
            background: #343a40;
            padding: 10px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
        }

        nav button {
            padding: 10px 15px;
            color: white;
            background: #495057;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }

        input,
        select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        button.action {
            margin-top: 15px;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #007bff;
            color: white;
        }

        .hidden {
            display: none;
        }

        .section-title {
            font-size: 20px;
            margin-top: 20px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }

        .result {
            margin-top: 15px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
        }

        .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            font-size: 16px;
        }

        @media print {
            body * {
                visibility: hidden;
            }

            #printArea,
            #printArea * {
                visibility: visible;
            }

            #printArea {
                position: fixed;
                left: 0;
                top: 0;
                width: 100%;
                background: white;
                padding: 20px;
                color: black;
            }
        }
    </style>
</head>

<body class="light">
    Â  Â  <header id="header_text">ğŸ’µ à¸£à¸°à¸šà¸šà¹à¸¥à¸à¹€à¸‡à¸´à¸™ - Fuji Mobile Shop</header>

    Â  Â  <nav>
        Â  Â  Â  Â  <button id="nav_dashboard" onclick="showScreen('dashboard')">ğŸ“Š à¸«à¸™à¹‰à¸²à¸­à¸±à¸•à¸£à¸²à¹à¸¥à¸à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™</button>
        Â  Â  Â  Â  <button id="nav_exchange" onclick="showScreen('exchange')">à¹à¸à¹‰à¹„à¸‚à¸­à¸±à¸•à¸£à¸²à¹à¸¥à¸à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ğŸ”„</button>
        Â  Â  Â  Â  <button id="nav_transaction" onclick="showScreen('transaction')">ğŸ“ˆ à¸­à¸±à¸•à¸£à¸²à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™</button>
        Â  Â  Â  Â  <button onclick="toggleTheme()">ğŸŒ™/â˜€ï¸</button>
        Â  Â  Â  Â  <button onclick="toggleLang()" id="lang_switch">ğŸŒ à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¸¥à¸²à¸§</button>
        Â  Â  </nav>


    Â  Â  <div class="container" id="dashboardScreen">
        Â  Â  Â  Â  <h2 class="section-title" id="dashboard_title">Dashboard</h2>

        Â  Â  Â  Â  <h3 id="rate_table_title">ğŸ’± àº­àº±àº”àº•àº²à»àº¥àºàº›à»ˆàº½àº™àº›àº°àºˆàº³àº§àº±àº™</h3>
        Â  Â  Â  Â  <table>
            Â  Â  Â  Â  Â  Â  <thead>
                Â  Â  Â  Â  Â  Â  Â  Â  <tr>
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th id="th_pair">à¸„à¸¹à¹ˆà¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™</th>
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th id="th_buy">Buy</th>
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th id="th_sell">Sell</th>
                    Â  Â  Â  Â  Â  Â  Â  Â  </tr>
                Â  Â  Â  Â  Â  Â  </thead>
            Â  Â  Â  Â  Â  Â  <tbody id="rateTable"></tbody>
            Â  Â  Â  Â  </table>

        Â  Â  Â  Â  <h3 id="cash_table_title">ğŸ’° à¹€à¸‡à¸´à¸™à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­</h3>
        Â  Â  Â  Â  <table>
            Â  Â  Â  Â  Â  Â  <thead>
                Â  Â  Â  Â  Â  Â  Â  Â  <tr>
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th id="th_currency">à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™</th>
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th id="th_balance">à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­</th>
                    Â  Â  Â  Â  Â  Â  Â  Â  </tr>
                Â  Â  Â  Â  Â  Â  </thead>
            Â  Â  Â  Â  Â  Â  <tbody id="cashTable"></tbody>
            Â  Â  Â  Â  </table>

        Â  Â  Â  Â  <h3 id="transaction_table_title">ğŸ“ à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¸¥à¹ˆà¸²à¸ªà¸¸à¸”</h3>
        Â  Â  Â  Â  <table>
            Â  Â  Â  Â  Â  Â  <thead>
                Â  Â  Â  Â  Â  Â  Â  Â  <tr>
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th id="th_time">à¹€à¸§à¸¥à¸²</th>
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th id="th_type">à¸›à¸£à¸°à¹€à¸ à¸—</th>
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th id="th_pair_tx">à¸„à¸¹à¹ˆ</th>
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th id="th_source_amt">à¸ˆà¸³à¸™à¸§à¸™</th>
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th id="th_target_amt">à¹„à¸”à¹‰à¸£à¸±à¸š</th>
                    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th id="th_delete">à¸¥à¸š</th>
                    Â  Â  Â  Â  Â  Â  Â  Â  </tr>
                Â  Â  Â  Â  Â  Â  </thead>
            Â  Â  Â  Â  Â  Â  <tbody id="transactionTable"></tbody>
            Â  Â  Â  Â  </table>

        Â  Â  Â  Â  <button class="action" onclick="exportPDF()" id="btn_export_pdf">ğŸ“„ Export PDF Report</button>
        Â  Â  Â  Â  <button class="action" onclick="exportExcel()" id="btn_export_excel">ğŸ“Š Export Excel</button>
        Â  Â  </div>

    Â  Â  <div class="container hidden" id="exchangeScreen">
        Â  Â  Â  Â  <h2 class="section-title" id="exchange_title">à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸­à¸±à¸•à¸£à¸²</h2>
        Â  Â  Â  Â  <div id="exchangeFormContainer"></div>
        Â  Â  Â  Â  <h3 style="margin-top:30px;" id="cash_edit_title">ğŸ’° à¹à¸à¹‰à¹„à¸‚ Cash Balance</h3>
        Â  Â  Â  Â  <div id="cashFormContainer"></div>
        Â  Â  </div>

    Â  Â  <div class="container hidden" id="transactionScreen">
        Â  Â  Â  Â  <h2 class="section-title" id="transaction_main_title">à¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£à¹à¸¥à¸à¹€à¸‡à¸´à¸™</h2>

        Â  Â  Â  Â  <label id="lbl_pair">à¸„à¸¹à¹ˆà¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™</label>
        Â  Â  Â  Â  <select id="currencyPair">
            Â  Â  Â  Â  Â  Â  <option value="THB-LAK">THB â†’ LAK</option>
            Â  Â  Â  Â  Â  Â  <option value="LAK-THB">LAK â†’ THB</option>
            Â  Â  Â  Â  Â  Â  <option value="LAK-CNY">LAK â†’ CNY</option>
            Â  Â  Â  Â  Â  Â  <option value="CNY-LAK">CNY â†’ LAK</option>
            Â  Â  Â  Â  Â  Â  <option value="USD-LAK">USD â†’ LAK</option>
            Â  Â  Â  Â  Â  Â  <option value="LAK-USD">LAK â†’ USD</option>
            Â  Â  Â  Â  </select>

        Â  Â  Â  Â  <label id="lbl_source">à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¸¥à¸¹à¸à¸„à¹‰à¸²à¹ƒà¸«à¹‰</label>
        Â  Â  Â  Â  <input type="number" id="sourceAmount">

        Â  Â  Â  Â  <label id="lbl_target">à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š</label>
        Â  Â  Â  Â  <input type="number" id="targetAmount" readonly>

        Â  Â  Â  Â  <button class="action" onclick="calculateExchange()" id="btn_calculate">à¸„à¸³à¸™à¸§à¸“à¹à¸¥à¸°à¸šà¸±à¸™à¸—à¸¶à¸</button>
        Â  Â  Â  Â  <button class="action" onclick="printReceipt()" id="btn_receipt">ğŸ§¾ à¸à¸´à¸¡à¸à¹Œà¹ƒà¸šà¹€à¸ªà¸£à¹‡à¸ˆ</button>

        Â  Â  Â  Â  <div class="result" id="transactionResult"></div>
        Â  Â  </div>

    Â  Â  <div id="printArea" class="hidden">
        Â  Â  Â  Â  <h2 style="text-align:center;">Fuji Mobile Shop</h2>
        Â  Â  Â  Â  <p style="text-align:center;" id="receipt_title">à¹ƒà¸šà¹€à¸ªà¸£à¹‡à¸ˆà¸£à¸±à¸šà¹€à¸‡à¸´à¸™</p>
        Â  Â  Â  Â 
        <hr>
        Â  Â  Â  Â  <div id="receiptContent"></div>
        Â  Â  Â  Â 
        <hr>
        Â  Â  Â  Â  <p style="text-align:center;" id="receipt_footer">à¸‚à¸­à¸šà¸„à¸¸à¸“à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸šà¸£à¸´à¸à¸²à¸£</p>
        Â  Â 
    </div>

    Â  Â 
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        // à¹€à¸à¸´à¹ˆà¸¡ get, remove, onValue
        import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

        // **************** à¹à¸à¹‰à¹„à¸‚ Firebase Config à¸”à¹‰à¸§à¸¢à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸­à¸‡à¸„à¸¸à¸“ *****************
        const firebaseConfig = {
            apiKey: "AIzaSyCDBfG-CETtk6md24wMZU1VDuzBZxQ7CPA",
            authDomain: "exchange-b556f.firebaseapp.com",
            databaseURL: "https://exchange-b556f-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "exchange-b556f",
            storageBucket: "exchange-b556f.firebasestorage.app",
            messagingSenderId: "697841962324",
            appId: "1:697841962324:web:4017936ad5527939924cc1",
            measurementId: "G-04M9BE4SZ2"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // ********************** à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆà¹€à¸à¸´à¹ˆà¸¡/à¹à¸à¹‰à¹„à¸‚: à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸š Rates à¹à¸¥à¸° Cash Balance **********************

        // New: Save Rates to DB
        function saveRatesToDB(newRates) {
            const ratesRef = ref(database, 'rates');
            set(ratesRef, newRates);
        }

        // New: Load Rates from DB
        function loadRates(callback) {
            const ratesRef = ref(database, 'rates');
            onValue(ratesRef, (snapshot) => {
                const data = snapshot.val();
                // Fallback to initial hardcoded rates if DB is empty.
                const initialRates = {
                    "THB-LAK": { buy: 300, sell: 305 },
                    "LAK-THB": { buy: 0.00325, sell: 0.0033 },
                    "LAK-CNY": { buy: 0.00045, sell: 0.00046 },
                    "CNY-LAK": { buy: 2170, sell: 2180 },
                    "USD-LAK": { buy: 18000, sell: 18200 },
                    "LAK-USD": { buy: 0.000054, sell: 0.000055 }
                };
                callback(data || initialRates);
            });
        }

        // New: Save Cash Balance to DB
        function saveCashToDB(newCashBalance) {
            const cashRef = ref(database, 'cashBalance');
            set(cashRef, newCashBalance);
        }

        // New: Load Cash Balance from DB
        function loadCashBalance(callback) {
            const cashRef = ref(database, 'cashBalance');
            onValue(cashRef, (snapshot) => {
                const data = snapshot.val();
                // Fallback to initial hardcoded cash if DB is empty.
                const initialCash = { THB: 50000, LAK: 50000000, CNY: 20000, USD: 1000 };
                callback(data || initialCash);
            });
        }

        // âœ… à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸šà¸±à¸™à¸—à¸¶à¸ Transaction
        // à¸šà¸±à¸™à¸—à¸¶à¸à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¹à¸¥à¹‰à¸§à¸ªà¹ˆà¸‡ ID à¸à¸¥à¸±à¸šà¸¡à¸² (à¸«à¸²à¸à¸ˆà¸³à¹€à¸›à¹‡à¸™)
        function saveTransaction(tx) {
            const txRef = push(ref(database, 'transactions'));
            // set(txRef, tx); // à¹à¸—à¸™à¸—à¸µà¹ˆà¸”à¹‰à¸§à¸¢à¸à¸²à¸£ set à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰ key à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸‡à¹ˆà¸²à¸¢à¸•à¹ˆà¸­à¸à¸²à¸£à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡
            set(txRef, tx);
            return txRef.key;
        }

        // âœ… à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹‚à¸«à¸¥à¸” Transactions
        // ********************** à¹à¸à¹‰à¹„à¸‚: à¸”à¸¶à¸‡ Firebase ID à¸¡à¸²à¸”à¹‰à¸§à¸¢ **********************
        function loadTransactions(callback) {
            const txRef = ref(database, 'transactions');
            onValue(txRef, (snapshot) => {
                const data = snapshot.val() || {};
                const arr = Object.keys(data).map(key => ({
                    _id: key, // à¸šà¸±à¸™à¸—à¸¶à¸ Firebase Key à¹€à¸›à¹‡à¸™ _id
                    ...data[key]
                }));
                callback(arr);
            });
        }

        // ********************** à¹€à¸à¸´à¹ˆà¸¡: à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸¥à¸š Transaction **********************
        function removeTransactionFromDB(txId) {
            const txRef = ref(database, 'transactions/' + txId);
            return remove(txRef); // à¸¥à¸šà¸ˆà¸²à¸ Firebase
        }

        // âœ… à¹ƒà¸«à¹‰à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸ˆà¸²à¸à¸—à¸µà¹ˆà¸­à¸·à¹ˆà¸™à¹„à¸”à¹‰
        window.saveTransaction = saveTransaction;
        window.loadTransactions = loadTransactions;
        window.removeTransactionFromDB = removeTransactionFromDB; // à¸—à¸³à¹ƒà¸«à¹‰à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰à¸ˆà¸²à¸à¸ à¸²à¸¢à¸™à¸­à¸à¹„à¸”à¹‰

        // ********************** Export New Functions **********************
        window.saveRatesToDB = saveRatesToDB;
        window.loadRates = loadRates;
        window.saveCashToDB = saveCashToDB;
        window.loadCashBalance = loadCashBalance;
        // ************************************************************************


        // âœ… à¹‚à¸«à¸¥à¸” Transactions à¸•à¸­à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸«à¸™à¹‰à¸²
        loadTransactions((data) => {
            transactions = data;
            updateDashboard();
            applyLanguage(lang); // à¸­à¸±à¸›à¹€à¸”à¸•à¸ à¸²à¸©à¸²à¹€à¸¡à¸·à¹ˆà¸­à¹‚à¸«à¸¥à¸”à¹€à¸ªà¸£à¹‡à¸ˆ
        });

        // ********************** New: Load Rates and Cash Balance **********************
        loadRates((data) => {
            rates = data;
            updateDashboard();
        });
        loadCashBalance((data) => {
            cashBalance = data;
            updateDashboard();
        });
        // ***********************************************************************************
    </script>

    Â  Â 
    <script>
        // ********************** à¹à¸à¹‰à¹„à¸‚: à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹à¸›à¸£à¸§à¹ˆà¸²à¸‡ à¹à¸¥à¸°à¸£à¸­à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ Firebase **********************
        // const rates = { ... };
        let rates = {};

        // let cashBalance = { ... };
        let cashBalance = {};
        // *****************************************************************************************************

        // transactions à¸ˆà¸°à¸–à¸¹à¸à¹‚à¸«à¸¥à¸”à¸ˆà¸²à¸ Firebase à¹ƒà¸™à¹‚à¸„à¹‰à¸” module
        let transactions = [];
        let lastTransaction = null;
        let lang = 'th'; // à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ à¸²à¸©à¸²à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹€à¸›à¹‡à¸™ 'th' à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸›à¸¸à¹ˆà¸¡à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹€à¸›à¹‡à¸™ 'ğŸŒ à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¸¥à¸²à¸§' à¹à¸¥à¸°à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹€à¸£à¸´à¹ˆà¸¡à¹à¸£à¸à¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¹„à¸—à¸¢

        function showScreen(s) {
            dashboardScreen.classList.add("hidden");
            exchangeScreen.classList.add("hidden");
            transactionScreen.classList.add("hidden");

            if (s === "dashboard") updateDashboard();
            if (s === "exchange") renderForms();

            window[s + "Screen"].classList.remove("hidden");
        }

        // ********************** à¹à¸à¹‰à¹„à¸‚: à¹€à¸à¸´à¹ˆà¸¡à¸›à¸¸à¹ˆà¸¡à¸¥à¸šà¹ƒà¸™à¸•à¸²à¸£à¸²à¸‡ **********************
        function updateDashboard() {
            // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² rates à¹à¸¥à¸° cashBalance à¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸¥à¹‰à¸§à¸à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¸ˆà¸°à¹à¸ªà¸”à¸‡à¸œà¸¥
            if (Object.keys(rates).length === 0 || Object.keys(cashBalance).length === 0) return;

            // à¸”à¸¶à¸‡à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ updateDashboard à¸—à¸µà¹ˆà¸‹à¹‰à¸³à¸‹à¹‰à¸­à¸™à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡à¸­à¸­à¸ à¹à¸¥à¸°à¹ƒà¸Šà¹‰à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸™à¸µà¹‰à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
            rateTable.innerHTML = Object.keys(rates).map(p =>
                `<tr><td>${p}</td><td>${rates[p].buy.toLocaleString()}</td><td>${rates[p].sell.toLocaleString()}</td></tr>`
            ).join("");

            cashTable.innerHTML = Object.keys(cashBalance).map(c =>
                `<tr><td>${c}</td><td>${cashBalance[c].toLocaleString()}</td></tr>`
            ).join("");

            // à¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸¥à¹ˆà¸²à¸ªà¸¸à¸” 5 à¸£à¸²à¸¢à¸à¸²à¸£ à¹à¸¥à¸°à¹à¸ªà¸”à¸‡à¸›à¸¸à¹ˆà¸¡à¸¥à¸š
            transactionTable.innerHTML = transactions.slice().reverse().slice(0, 5).map(t =>
                `<tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${t.time}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${t.type}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${t.pair}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${parseFloat(t.sourceAmount).toLocaleString()}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${parseFloat(t.targetAmount).toLocaleString()}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><button class="delete-btn" onclick="removeTransaction('${t._id}')">âŒ</button></td>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>`
            ).join("");
        }

        function calculateExchange() {
            const pair = currencyPair.value;
            const amt = parseFloat(sourceAmount.value);
            if (!amt || amt <= 0) return alert(lang === 'th' ? "à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡" : "àºàº°àº¥àº¸àº™àº²à»ƒàºªà»ˆàºˆàº³àº™àº§àº™à»€àº‡àº´àº™àº—àºµà»ˆàº–àº·àºàº•à»‰àº­àº‡");

            // à¹ƒà¸Šà¹‰à¸­à¸±à¸•à¸£à¸² 'Sell' à¸‚à¸­à¸‡à¸£à¹‰à¸²à¸™ (à¸¥à¸¹à¸à¸„à¹‰à¸²à¸‹à¸·à¹‰à¸­à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™à¸•à¹‰à¸™à¸ˆà¸²à¸à¸£à¹‰à¸²à¸™)
            const rate = rates[pair].sell;
            const result = amt * rate;
            targetAmount.value = result.toFixed(2);

            const [from, to] = pair.split("-");
            // à¸­à¸±à¸›à¹€à¸”à¸• Cash Balance: à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š (Source) à¹€à¸à¸´à¹ˆà¸¡, à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¸ˆà¹ˆà¸²à¸¢ (Target) à¸¥à¸”
            // à¹€à¸™à¸·à¹ˆà¸­à¸‡à¸ˆà¸²à¸à¸™à¸µà¹ˆà¸„à¸·à¸­à¸¡à¸¸à¸¡à¸¡à¸­à¸‡à¸‚à¸­à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸µà¹ˆà¹à¸¥à¸à¹€à¸‡à¸´à¸™
            // à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¸£à¹‰à¸²à¸™à¹„à¸”à¹‰à¸£à¸±à¸šà¸„à¸·à¸­ Source (à¹€à¸à¸´à¹ˆà¸¡)
            // à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¸£à¹‰à¸²à¸™à¸ˆà¹ˆà¸²à¸¢à¸„à¸·à¸­ Target (à¸¥à¸”)
            cashBalance[from] += amt;
            cashBalance[to] -= result;

            // ********************** FIX: à¸šà¸±à¸™à¸—à¸¶à¸ Cash Balance à¸¥à¸‡ Firebase **********************
            saveCashToDB(cashBalance);
            // ***********************************************************************************


            lastTransaction = {
                time: new Date().toLocaleString(),
                type: lang === 'th' ? "à¹à¸¥à¸à¹€à¸‡à¸´à¸™" : "à»àº¥àºàº›à»ˆàº½àº™",
                pair,
                sourceAmount: amt,
                targetAmount: result.toFixed(2)
            };

            // ********************** à¹à¸à¹‰à¹„à¸‚: à¸šà¸±à¸™à¸—à¸¶à¸à¸£à¸²à¸¢à¸à¸²à¸£à¸¥à¸‡ Firebase à¹à¸¥à¸°à¹€à¸à¹‡à¸š ID **********************
            const txId = saveTransaction(lastTransaction);
            lastTransaction._id = txId; // à¹€à¸à¸´à¹ˆà¸¡ ID à¹ƒà¸«à¹‰à¸à¸±à¸š lastTransaction
            transactions.push(lastTransaction);
            // à¹à¸ªà¸”à¸‡à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸
            transactionResult.innerHTML = lang === 'th' ? "âœ… à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢" : "âœ… àºšàº±àº™àº—àº¶àºàºªàº³à»€àº¥àº±àº”à»àº¥à»‰àº§";
            updateDashboard();

            // à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸£à¸µà¸¢à¸ saveTransaction(lastTransaction) à¸‹à¹‰à¸³ à¹€à¸à¸£à¸²à¸°à¸—à¸³à¹ƒà¸™à¹‚à¸„à¹‰à¸” module à¹à¸¥à¹‰à¸§
        }

        function printReceipt() {
            // à¹ƒà¸Šà¹‰à¸ à¸²à¸©à¸²à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸
            if (!lastTransaction) return alert(lang === 'th' ? "à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸£à¸²à¸¢à¸à¸²à¸£à¹ƒà¸«à¹‰à¸à¸´à¸¡à¸à¹Œ" : "àºàº±àº‡àºšà»à»ˆàº¡àºµàº¥àº²àºàºàº²àº™à»ƒàº«à»‰àºàº´àº¡");

            receiptContent.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <p>${lang === 'th' ? "à¹€à¸§à¸¥à¸²" : "à»€àº§àº¥àº²"}: ${lastTransaction.time}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>${lang === 'th' ? "à¸„à¸¹à¹ˆà¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™" : "àº„àº¹à»ˆàºªàº°àºàº¸àº™à»€àº‡àº´àº™"}: ${lastTransaction.pair}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>${lang === 'th' ? "à¸ˆà¸³à¸™à¸§à¸™à¸—à¸µà¹ˆà¹ƒà¸«à¹‰" : "àºˆàº³àº™àº§àº™àº—àºµà»ˆà»ƒàº«à»‰"}: ${lastTransaction.sourceAmount.toLocaleString()}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>${lang === 'th' ? "à¸ˆà¸³à¸™à¸§à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š" : "àºˆàº³àº™àº§àº™àº—àºµà»ˆà»„àº”à»‰àº®àº±àºš"}: ${lastTransaction.targetAmount.toLocaleString()}</p>
Â  Â  Â  Â  Â  Â  `;

            printArea.classList.remove("hidden");
            window.print();
            printArea.classList.add("hidden");
        }

        function toggleTheme() {
            document.body.classList.toggle("dark");
        }

        function renderForms() {
            exchangeFormContainer.innerHTML = Object.keys(rates).map(p => `
Â  Â  Â  Â  Â  Â  Â  Â  <label id="lbl_buy_${p}">${p} Buy</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="${p}-buy" type="number" value="${rates[p].buy}">
Â  Â  Â  Â  Â  Â  Â  Â  <label id="lbl_sell_${p}">${p} Sell</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="${p}-sell" type="number" value="${rates[p].sell}">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="action" onclick="updateRate('${p}')" id="btn_rate_${p}">à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸£à¸—</button><hr>
Â  Â  Â  Â  Â  Â  `).join("");

            cashFormContainer.innerHTML = Object.keys(cashBalance).map(cur => `
Â  Â  Â  Â  Â  Â  Â  Â  <label id="lbl_cash_${cur}">${cur} Cash Balance</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="cash-${cur}" value="${cashBalance[cur]}">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="action" onclick="updateCash('${cur}')" id="btn_cash_${cur}">à¸šà¸±à¸™à¸—à¸¶à¸à¸¢à¸­à¸”</button>
Â  Â  Â  Â  Â  Â  `).join("");

            // à¸­à¸±à¸›à¹€à¸”à¸•à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸™à¸Ÿà¸­à¸£à¹Œà¸¡à¹à¸à¹‰à¹„à¸‚à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸
            applyExchangeFormsLang(lang);
        }

        function updateRate(pair) {
            rates[pair].buy = parseFloat(document.getElementById(pair + "-buy").value);
            rates[pair].sell = parseFloat(document.getElementById(pair + "-sell").value);

            // ********************** FIX: à¸šà¸±à¸™à¸—à¸¶à¸ Rates à¸¥à¸‡ Firebase **********************
            saveRatesToDB(rates);
            // ************************************************************************

            alert(lang === 'th' ? "à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸£à¸—à¹à¸¥à¹‰à¸§" : "àºšàº±àº™àº—àº¶àºàº­àº±àº”àº•àº²àºªàº³à»€àº¥àº±àº”à»àº¥à»‰àº§");
            // updateDashboard(); // à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸£à¸µà¸¢à¸à¸‹à¹‰à¸³ à¹€à¸à¸£à¸²à¸° onValue listener à¹ƒà¸™à¹‚à¸¡à¸”à¸¹à¸¥à¸ˆà¸°à¸ˆà¸±à¸”à¸à¸²à¸£à¹€à¸­à¸‡
        }

        function updateCash(cur) {
            cashBalance[cur] = parseFloat(document.getElementById("cash-" + cur).value);

            // ********************** FIX: à¸šà¸±à¸™à¸—à¸¶à¸ Cash Balance à¸¥à¸‡ Firebase **********************
            saveCashToDB(cashBalance);
            // ***********************************************************************************

            alert(lang === 'th' ? "à¸­à¸±à¸›à¹€à¸”à¸•à¸¢à¸­à¸”à¹à¸¥à¹‰à¸§" : "àº­àº±àºšà»€àº”àº”àºàº­àº”à»€àº‡àº´àº™àºªàº³à»€àº¥àº±àº”à»àº¥à»‰àº§");
            // updateDashboard(); // à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸£à¸µà¸¢à¸à¸‹à¹‰à¸³ à¹€à¸à¸£à¸²à¸° onValue listener à¹ƒà¸™à¹‚à¸¡à¸”à¸¹à¸¥à¸ˆà¸°à¸ˆà¸±à¸”à¸à¸²à¸£à¹€à¸­à¸‡
        }

        showScreen("dashboard"); // à¹à¸ªà¸”à¸‡à¸«à¸™à¹‰à¸²à¹à¸£à¸

        // ********************** à¹€à¸à¸´à¹ˆà¸¡: à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸¥à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¸ˆà¸²à¸à¸«à¸™à¹‰à¸²à¸ˆà¸­à¹à¸¥à¸° Firebase **********************
        window.removeTransaction = async function (txId) {
            // à¹ƒà¸Šà¹‰à¸ à¸²à¸©à¸²à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸à¹ƒà¸™à¸à¸²à¸£à¸¢à¸·à¸™à¸¢à¸±à¸™
            const confirmation = lang === 'th' ?
                "à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¸™à¸µà¹‰à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?" :
                "àº—à»ˆàº²àº™àº•à»‰àº­àº‡àºàº²àº™àº¥àº¶àºšàº¥àº²àºàºàº²àº™à»àº¥àºàº›à»ˆàº½àº™àº™àºµà»‰ àº«àº¼àº· àºšà»à»ˆ?";
            if (confirm(confirmation)) {
                try {
                    // à¸¥à¸šà¸ˆà¸²à¸ Firebase (à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ˆà¸²à¸à¹‚à¸„à¹‰à¸” module)
                    await removeTransactionFromDB(txId);

                    // à¸¥à¸šà¸­à¸­à¸à¸ˆà¸²à¸ Array à¹ƒà¸™à¸«à¸™à¹ˆà¸§à¸¢à¸„à¸§à¸²à¸¡à¸ˆà¸³ (à¸«à¸²à¸à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹ƒà¸«à¹‰à¹€à¸«à¹‡à¸™à¸œà¸¥à¸—à¸±à¸™à¸—à¸µ)
                    // à¹‚à¸„à¹‰à¸” loadTransactions à¹ƒà¸™ module à¸ˆà¸°à¸—à¸³à¸à¸²à¸£à¸­à¸±à¸›à¹€à¸”à¸• Array transactions
                    // à¹à¸¥à¸°à¹€à¸£à¸µà¸¢à¸ updateDashboard() à¹‚à¸”à¸¢à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¹€à¸¡à¸·à¹ˆà¸­ Firebase à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™
                    // à¸”à¸±à¸‡à¸™à¸±à¹‰à¸™à¸ˆà¸¶à¸‡à¹„à¸¡à¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™à¸•à¹‰à¸­à¸‡à¸­à¸±à¸›à¹€à¸”à¸• Array à¹€à¸­à¸‡à¹ƒà¸™à¹‚à¸„à¹‰à¸”à¸™à¸µà¹‰
                    // à¹à¸•à¹ˆà¸–à¹‰à¸²à¹‚à¸„à¹‰à¸” loadTransactions à¹„à¸¡à¹ˆà¹€à¸£à¸µà¸¢à¸ updateDashboard
                    // à¸«à¸£à¸·à¸­à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸à¸²à¸£à¸•à¸­à¸šà¸ªà¸™à¸­à¸‡à¸—à¸µà¹ˆà¹€à¸£à¹‡à¸§à¸à¸§à¹ˆà¸² à¹ƒà¸«à¹‰à¸—à¸³à¸•à¸²à¸¡à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡

                    // à¸à¸£à¸­à¸‡à¸£à¸²à¸¢à¸à¸²à¸£à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¸­à¸­à¸à¸ˆà¸²à¸ Array
                    transactions = transactions.filter(t => t._id !== txId);

                    // à¸­à¸±à¸›à¹€à¸”à¸•à¸«à¸™à¹‰à¸² Dashboard
                    updateDashboard();

                } catch (error) {
                    console.error("Error removing transaction: ", error);
                    alert(lang === 'th' ? "à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸¥à¸šà¸£à¸²à¸¢à¸à¸²à¸£" : "à»€àºàºµàº”àº‚à»à»‰àºœàº´àº”àºàº²àº”à»ƒàº™àºàº²àº™àº¥àº¶àºšàº¥àº²àºàºàº²àº™");
                }
            }
        }

        // =================================== à¸£à¸°à¸šà¸šà¹à¸›à¸¥à¸ à¸²à¸©à¸²à¹ƒà¸«à¸¡à¹ˆ ===================================
        const translations = {
            th: {
                header_text: "ğŸ’µ à¸£à¸°à¸šà¸šà¹à¸¥à¸à¹€à¸‡à¸´à¸™ - Fuji Mobile Shop",
                nav_dashboard: "ğŸ“Š à¸«à¸™à¹‰à¸²à¸­à¸±à¸•à¸£à¸²à¹à¸¥à¸à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™",
                nav_exchange: "à¹à¸à¹‰à¹„à¸‚à¸­à¸±à¸•à¸£à¸²à¹à¸¥à¸à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ğŸ”„",
                nav_transaction: "ğŸ“ˆ à¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£à¹à¸¥à¸à¹€à¸‡à¸´à¸™",
                dashboard_title: "Dashboard",
                rate_table_title: "ğŸ’± à¸­à¸±à¸•à¸£à¸²à¹à¸¥à¸à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸›à¸£à¸°à¸ˆà¸³à¸§à¸±à¸™",
                th_pair: "à¸„à¸¹à¹ˆà¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™",
                th_buy: "à¸‹à¸·à¹‰à¸­ (Buy)",
                th_sell: "à¸‚à¸²à¸¢ (Sell)",
                cash_table_title: "ğŸ’° à¹€à¸‡à¸´à¸™à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
                th_currency: "à¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™",
                th_balance: "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­",
                transaction_table_title: "ğŸ“ à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¸¥à¹ˆà¸²à¸ªà¸¸à¸”",
                th_time: "à¹€à¸§à¸¥à¸²",
                th_type: "à¸›à¸£à¸°à¹€à¸ à¸—",
                th_pair_tx: "à¸„à¸¹à¹ˆ",
                th_source_amt: "à¸ˆà¸³à¸™à¸§à¸™à¸—à¸µà¹ˆà¹ƒà¸«à¹‰",
                th_target_amt: "à¸ˆà¸³à¸™à¸§à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š",
                th_delete: "à¸¥à¸š",
                btn_export_pdf: "ğŸ“„ Export PDF Report",
                btn_export_excel: "ğŸ“Š Export Excel",
                exchange_title: "à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸­à¸±à¸•à¸£à¸²",
                cash_edit_title: "ğŸ’° à¹à¸à¹‰à¹„à¸‚ Cash Balance",
                transaction_main_title: "à¸—à¸³à¸£à¸²à¸¢à¸à¸²à¸£à¹à¸¥à¸à¹€à¸‡à¸´à¸™",
                lbl_pair: "à¸„à¸¹à¹ˆà¸ªà¸à¸¸à¸¥à¹€à¸‡à¸´à¸™",
                lbl_source: "à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¸¥à¸¹à¸à¸„à¹‰à¸²à¹ƒà¸«à¹‰",
                lbl_target: "à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š",
                btn_calculate: "à¸„à¸³à¸™à¸§à¸“à¹à¸¥à¸°à¸šà¸±à¸™à¸—à¸¶à¸",
                btn_receipt: "ğŸ§¾ à¸à¸´à¸¡à¸à¹Œà¹ƒà¸šà¹€à¸ªà¸£à¹‡à¸ˆ",
                receipt_title: "à¹ƒà¸šà¹€à¸ªà¸£à¹‡à¸ˆà¸£à¸±à¸šà¹€à¸‡à¸´à¸™",
                receipt_footer: "à¸‚à¸­à¸šà¸„à¸¸à¸“à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸šà¸£à¸´à¸à¸²à¸£",
                lang_switch: "ğŸŒ à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¸¥à¸²à¸§",
                // à¸ªà¸³à¸«à¸£à¸±à¸šà¸Ÿà¸­à¸£à¹Œà¸¡à¹à¸à¹‰à¹„à¸‚à¸­à¸±à¸•à¸£à¸²/à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­
                exchange_rate_buy: "Buy",
                exchange_rate_sell: "Sell",
                exchange_btn_rate: "à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸£à¸—",
                exchange_cash_balance: "Cash Balance",
                exchange_btn_cash: "à¸šà¸±à¸™à¸—à¸¶à¸à¸¢à¸­à¸”"
            },
            lo: {
                header_text: "ğŸ’µ àº¥àº°àºšàº»àºšà»àº¥àºàº›à»ˆàº½àº™àºàº²àºà»ƒàº™àº®à»‰àº²àº™ - Fuji Mobile Shop",
                nav_dashboard: "ğŸ“Š à»œà»‰àº²àº­àº±àº”àº•àº²à»àº¥àºàº›à»ˆàº½àº™",
                nav_exchange: "à»àºà»‰à»„àº‚àº­àº±àº”àº•àº²à»àº¥àºàº›à»ˆàº½àº™ğŸ”„",
                nav_transaction: "ğŸ“ˆ à»€àº®àº±àº”àº¥àº²àºàºàº²àº™à»àº¥àºàº›à»ˆàº½àº™",
                dashboard_title: "Dashboard",
                rate_table_title: "ğŸ’± àº­àº±àº”àº•àº²à»àº¥àºàº›à»ˆàº½àº™àº›àº°àºˆàº³àº§àº±àº™",
                th_pair: "àº„àº¹à»ˆàºªàº°àºàº¸àº™à»€àº‡àº´àº™",
                th_buy: "àºŠàº·à»‰ (Buy)",
                th_sell: "àº‚àº²àº (Sell)",
                cash_table_title: "ğŸ’° àºàº­àº”à»€àº‡àº´àº™àº„àº»àº‡à»€àº«àº¼àº·àº­",
                th_currency: "àºªàº°àºàº¸àº™à»€àº‡àº´àº™",
                th_balance: "àºàº­àº”àº„àº»àº‡à»€àº«àº¼àº·àº­",
                transaction_table_title: "ğŸ“ àº¥àº²àºàºàº²àº™à»àº¥àºàº›à»ˆàº½àº™àº¥à»ˆàº²àºªàº¸àº”",
                th_time: "à»€àº§àº¥àº²",
                th_type: "àº›àº°à»€àºàº”",
                th_pair_tx: "àº„àº¹à»ˆ",
                th_source_amt: "àºˆàº³àº™àº§àº™àº—àºµà»ˆà»ƒàº«à»‰",
                th_target_amt: "àºˆàº³àº™àº§àº™àº—àºµà»ˆà»„àº”à»‰àº®àº±àºš",
                th_delete: "àº¥àº¶àºš",
                btn_export_pdf: "ğŸ“„ àºªàº»à»ˆàº‡àº­àº­àºàº¥àº²àºàº‡àº²àº™ PDF",
                btn_export_excel: "ğŸ“Š àºªàº»à»ˆàº‡àº­àº­àº Excel",
                exchange_title: "àº•àº±à»‰àº‡àº„à»ˆàº²àº­àº±àº”àº•àº²",
                cash_edit_title: "ğŸ’° à»àºà»‰à»„àº‚àºàº­àº”à»€àº‡àº´àº™àº„àº»àº‡à»€àº«àº¼àº·àº­",
                transaction_main_title: "à»€àº®àº±àº”àº¥àº²àºàºàº²àº™à»àº¥àºàº›à»ˆàº½àº™",
                lbl_pair: "àº„àº¹à»ˆàºªàº°àºàº¸àº™à»€àº‡àº´àº™",
                lbl_source: "à»€àº‡àº´àº™àº—àºµà»ˆàº¥àº¹àºàº„à»‰àº²à»ƒàº«à»‰",
                lbl_target: "à»€àº‡àº´àº™àº—àºµà»ˆà»„àº”à»‰àº®àº±àºš",
                btn_calculate: "àº„àº³àº™àº§àº™à»àº¥àº°àºšàº±àº™àº—àº¶àº",
                btn_receipt: "ğŸ§¾ àºàº´àº¡à»ƒàºšà»€àºàº±àºšà»€àº‡àº´àº™",
                receipt_title: "à»ƒàºšàº®àº±àºšà»€àº‡àº´àº™",
                receipt_footer: "àº‚àº­àºšà»ƒàºˆàº—àºµà»ˆà»ƒàºŠà»‰àºšà»àº¥àº´àºàº²àº™",
                lang_switch: "ğŸŒ àº›à»ˆàº½àº™à»€àº›àº±àº™àºàº²àºªàº²à»„àº—",
                // à¸ªà¸³à¸«à¸£à¸±à¸šà¸Ÿà¸­à¸£à¹Œà¸¡à¹à¸à¹‰à¹„à¸‚à¸­à¸±à¸•à¸£à¸²/à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­
                exchange_rate_buy: "àºŠàº·à»‰",
                exchange_rate_sell: "àº‚àº²àº",
                exchange_btn_rate: "àºšàº±àº™àº—àº¶àºàº­àº±àº”àº•àº²",
                exchange_cash_balance: "àºàº­àº”à»€àº‡àº´àº™àº„àº»àº‡à»€àº«àº¼àº·àº­",
                exchange_btn_cash: "àºšàº±àº™àº—àº¶àºàºàº­àº”"
            }
        };

        function applyLanguage(currentLang) {
            const t = translations[currentLang];
            document.getElementById('header_text').innerText = t.header_text;
            document.getElementById('nav_dashboard').innerText = t.nav_dashboard;
            document.getElementById('nav_exchange').innerText = t.nav_exchange;
            document.getElementById('nav_transaction').innerText = t.nav_transaction;
            document.getElementById('lang_switch').innerText = t.lang_switch;

            // Dashboard
            document.getElementById('dashboard_title').innerText = t.dashboard_title;
            document.getElementById('rate_table_title').innerText = t.rate_table_title;
            document.getElementById('th_pair').innerText = t.th_pair;
            document.getElementById('th_buy').innerText = t.th_buy;
            document.getElementById('th_sell').innerText = t.th_sell;
            document.getElementById('cash_table_title').innerText = t.cash_table_title;
            document.getElementById('th_currency').innerText = t.th_currency;
            document.getElementById('th_balance').innerText = t.th_balance;
            document.getElementById('transaction_table_title').innerText = t.transaction_table_title;
            document.getElementById('th_time').innerText = t.th_time;
            document.getElementById('th_type').innerText = t.th_type;
            document.getElementById('th_pair_tx').innerText = t.th_pair_tx;
            document.getElementById('th_source_amt').innerText = t.th_source_amt;
            document.getElementById('th_target_amt').innerText = t.th_target_amt;
            document.getElementById('th_delete').innerText = t.th_delete;
            document.getElementById('btn_export_pdf').innerText = t.btn_export_pdf;
            document.getElementById('btn_export_excel').innerText = t.btn_export_excel;
            document.getElementById('title_header_lo').innerText = currentLang === 'lo' ? "ğŸ’µ àº¥àº°àºšàº»àºšà»àº¥àºàº›à»ˆàº½àº™àºàº²àºà»ƒàº™àº®à»‰àº²àº™ - àº™àº²àº‡àº›àº²àºŠà»‰àº­àºàºŠàº»à»ˆàº‡" : "ğŸ’µ à¸£à¸°à¸šà¸šà¹à¸¥à¸à¹€à¸‡à¸´à¸™ - Fuji Mobile Shop";


            // Exchange Screen
            document.getElementById('exchange_title').innerText = t.exchange_title;
            document.getElementById('cash_edit_title').innerText = t.cash_edit_title;
            applyExchangeFormsLang(currentLang);


            // Transaction Screen
            document.getElementById('transaction_main_title').innerText = t.transaction_main_title;
            document.getElementById('lbl_pair').innerText = t.lbl_pair;
            document.getElementById('lbl_source').innerText = t.lbl_source;
            document.getElementById('lbl_target').innerText = t.lbl_target;
            document.getElementById('btn_calculate').innerText = t.btn_calculate;
            document.getElementById('btn_receipt').innerText = t.btn_receipt;
            document.getElementById('receipt_title').innerText = t.receipt_title;
            document.getElementById('receipt_footer').innerText = t.receipt_footer;
        }

        function applyExchangeFormsLang(currentLang) {
            const t = translations[currentLang];
            // à¸­à¸±à¸›à¹€à¸”à¸•à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸™à¸Ÿà¸­à¸£à¹Œà¸¡à¹à¸à¹‰à¹„à¸‚à¸­à¸±à¸•à¸£à¸²
            Object.keys(rates).forEach(p => {
                const lblBuy = document.getElementById(`lbl_buy_${p}`);
                const lblSell = document.getElementById(`lbl_sell_${p}`);
                const btnRate = document.getElementById(`btn_rate_${p}`);
                if (lblBuy) lblBuy.innerText = `${p} ${t.exchange_rate_buy}`;
                if (lblSell) lblSell.innerText = `${p} ${t.exchange_rate_sell}`;
                if (btnRate) btnRate.innerText = t.exchange_btn_rate;
            });

            // à¸­à¸±à¸›à¹€à¸”à¸•à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸™à¸Ÿà¸­à¸£à¹Œà¸¡à¹à¸à¹‰à¹„à¸‚à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­
            Object.keys(cashBalance).forEach(cur => {
                const lblCash = document.getElementById(`lbl_cash_${cur}`);
                const btnCash = document.getElementById(`btn_cash_${cur}`);
                if (lblCash) lblCash.innerText = `${cur} ${t.exchange_cash_balance}`;
                if (btnCash) btnCash.innerText = t.exchange_btn_cash;
            });
        }


        window.toggleLang = function () {
            lang = lang === 'lo' ? 'th' : 'lo';
            applyLanguage(lang);
        }

        // à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸ à¸²à¸©à¸²à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹€à¸¡à¸·à¹ˆà¸­à¹‚à¸«à¸¥à¸”à¸«à¸™à¹‰à¸²à¸ˆà¸­
        applyLanguage(lang);
    </script>
</body>

</html>
