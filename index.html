<!DOCTYPE html>
<html lang="th">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title_header_lo">üíµ ‡∫•‡∫∞‡∫ö‡∫ª‡∫ö‡ªÅ‡∫•‡∫Å‡∫õ‡ªà‡∫Ω‡∫ô‡∫û‡∫≤‡∫ç‡ªÉ‡∫ô‡∫Æ‡ªâ‡∫≤‡∫ô - ‡∫ô‡∫≤‡∫á‡∫õ‡∫≤‡∫ä‡ªâ‡∫≠‡∫ç‡∫ä‡∫ª‡ªà‡∫á</title>

    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f4f4f4;
        }

        body.dark {
            background: #121212;
            color: #e0e0e0;
        }

        body.dark .container {
            background: #1e1e1e;
            color: #e0e0e0;
        }

        body.dark nav {
            background: #1f1f1f;
        }

        body.dark nav button {
            background: #2c2c2c;
        }

        header {
            background: #007bff;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 24px;
        }

        nav {
            background: #343a40;
            padding: 10px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
        }

        nav button {
            padding: 10px 15px;
            color: white;
            background: #495057;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }

        input,
        select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        button.action {
            margin-top: 15px;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #007bff;
            color: white;
        }

        .hidden {
            display: none;
        }

        .section-title {
            font-size: 20px;
            margin-top: 20px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }

        .result {
            margin-top: 15px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
        }

        .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            font-size: 16px;
        }

        @media print {
            body * {
                visibility: hidden;
            }

            #printArea,
            #printArea * {
                visibility: visible;
            }

            #printArea {
                position: fixed;
                left: 0;
                top: 0;
                width: 100%;
                background: white;
                padding: 20px;
                color: black;
            }
        }
    </style>
</head>

<body class="light">
    <header id="header_text">üíµ ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏Å‡πÄ‡∏á‡∏¥‡∏ô - Fuji Mobile Shop</header>

    <nav>
        <button id="nav_dashboard" onclick="showScreen('dashboard')">üìä ‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</button>
        <button id="nav_exchange" onclick="showScreen('exchange')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ôüîÑ</button>
        <button id="nav_transaction" onclick="showScreen('transaction')">üìà ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>
        <button onclick="toggleTheme()">üåô/‚òÄÔ∏è</button>
        <button onclick="toggleLang()" id="lang_switch">üåê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏•‡∏≤‡∏ß</button>
    </nav>


    <div class="container" id="dashboardScreen">
        <h2 class="section-title" id="dashboard_title">Dashboard</h2>

        <h3 id="rate_table_title">üí± ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h3>
        <table>
            <thead>
                <tr>
                    <th id="th_pair">‡∏Ñ‡∏π‡πà‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô</th>
                    <th id="th_buy">Buy</th>
                    <th id="th_sell">Sell</th>
                </tr>
            </thead>
            <tbody id="rateTable"></tbody>
        </table>

        <h3 id="cash_table_title">üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h3>
        <table>
            <thead>
                <tr>
                    <th id="th_currency">‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô</th>
                    <th id="th_balance">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                </tr>
            </thead>
            <tbody id="cashTable"></tbody>
        </table>

        <h3 id="transaction_table_title">üìù ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
        <table>
            <thead>
                <tr>
                    <th id="th_time">‡πÄ‡∏ß‡∏•‡∏≤</th>
                    <th id="th_type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                    <th id="th_pair_tx">‡∏Ñ‡∏π‡πà</th>
                    <th id="th_source_amt">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                    <th id="th_target_amt">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</th>
                    <th id="th_delete">‡∏•‡∏ö</th>
                </tr>
            </thead>
            <tbody id="transactionTable"></tbody>
        </table>

        <button class="action" onclick="exportPDF()" id="btn_export_pdf">üìÑ Export PDF Report</button>
        <button class="action" onclick="exportExcel()" id="btn_export_excel">üìä Export Excel</button>
    </div>

    <div class="container hidden" id="exchangeScreen">
        <h2 class="section-title" id="exchange_title">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏±‡∏ï‡∏£‡∏≤</h2>
        <div id="exchangeFormContainer"></div>
        <h3 style="margin-top:30px;" id="cash_edit_title">üí∞ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Cash Balance</h3>
        <div id="cashFormContainer"></div>
    </div>

    <div class="container hidden" id="transactionScreen">
        <h2 class="section-title" id="transaction_main_title">‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</h2>

        <label id="lbl_pair">‡∏Ñ‡∏π‡πà‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô</label>
        <select id="currencyPair">
            <option value="THB-LAK">THB ‚Üí LAK</option>
            <option value="LAK-THB">LAK ‚Üí THB</option>
            <option value="LAK-CNY">LAK ‚Üí CNY</option>
            <option value="CNY-LAK">CNY ‚Üí LAK</option>
            <option value="USD-LAK">USD ‚Üí LAK</option>
            <option value="LAK-USD">LAK ‚Üí USD</option>
        </select>

        <label id="lbl_source">‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ</label>
        <input type="number" id="sourceAmount">

        <label id="lbl_target">‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</label>
        <input type="number" id="targetAmount" readonly>

        <button class="action" onclick="calculateExchange()" id="btn_calculate">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button class="action" onclick="printReceipt()" id="btn_receipt">üßæ ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</button>

        <div class="result" id="transactionResult"></div>
    </div>

    <div id="printArea" class="hidden">
        <h2 style="text-align:center;">Fuji Mobile Shop</h2>
        <p style="text-align:center;" id="receipt_title">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</p>

        <hr>
        <div id="receiptContent"></div>

        <hr>
        <p style="text-align:center;" id="receipt_footer">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>

    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° get, remove, onValue
        import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

        // **************** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Firebase Config ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì *****************
        const firebaseConfig = {
            apiKey: "AIzaSyCDBfG-CETtk6md24wMZU1VDuzBZxQ7CPA",
            authDomain: "exchange-b556f.firebaseapp.com",
            databaseURL: "https://exchange-b556f-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "exchange-b556f",
            storageBucket: "exchange-b556f.firebasestorage.app",
            messagingSenderId: "697841962324",
            appId: "1:697841962324:web:4017936ad5527939924cc1",
            measurementId: "G-04M9BE4SZ2"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // ********************** ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Rates ‡πÅ‡∏•‡∏∞ Cash Balance **********************

        // New: Save Rates to DB
        function saveRatesToDB(newRates) {
            const ratesRef = ref(database, 'rates');
            set(ratesRef, newRates);
        }

        // New: Load Rates from DB
        function loadRates(callback) {
            const ratesRef = ref(database, 'rates');
            onValue(ratesRef, (snapshot) => {
                const data = snapshot.val();
                // Fallback to initial hardcoded rates if DB is empty.
                const initialRates = {
                    "THB-LAK": { buy: 300, sell: 305 },
                    "LAK-THB": { buy: 0.00325, sell: 0.0033 },
                    "LAK-CNY": { buy: 0.00045, sell: 0.00046 },
                    "CNY-LAK": { buy: 2170, sell: 2180 },
                    "USD-LAK": { buy: 18000, sell: 18200 },
                    "LAK-USD": { buy: 0.000054, sell: 0.000055 }
                };
                callback(data || initialRates);
            });
        }

        // New: Save Cash Balance to DB
        function saveCashToDB(newCashBalance) {
            const cashRef = ref(database, 'cashBalance');
            set(cashRef, newCashBalance);
        }

        // New: Load Cash Balance from DB
        function loadCashBalance(callback) {
            const cashRef = ref(database, 'cashBalance');
            onValue(cashRef, (snapshot) => {
                const data = snapshot.val();
                // Fallback to initial hardcoded cash if DB is empty.
                const initialCash = { THB: 50000, LAK: 50000000, CNY: 20000, USD: 1000 };
                callback(data || initialCash);
            });
        }

        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Transaction
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á ID ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ (‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
        function saveTransaction(tx) {
            const txRef = push(ref(database, 'transactions'));
            // set(txRef, tx); // ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ set ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ key ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
            set(txRef, tx);
            return txRef.key;
        }

        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î Transactions
        // ********************** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏î‡∏∂‡∏á Firebase ID ‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢ **********************
        function loadTransactions(callback) {
            const txRef = ref(database, 'transactions');
            onValue(txRef, (snapshot) => {
                const data = snapshot.val() || {};
                const arr = Object.keys(data).map(key => ({
                    _id: key, // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Firebase Key ‡πÄ‡∏õ‡πá‡∏ô _id
                    ...data[key]
                }));
                callback(arr);
            });
        }

        // ********************** ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö Transaction **********************
        function removeTransactionFromDB(txId) {
            const txRef = ref(database, 'transactions/' + txId);
            return remove(txRef); // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Firebase
        }

        // ‚úÖ ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ
        window.saveTransaction = saveTransaction;
        window.loadTransactions = loadTransactions;
        window.removeTransactionFromDB = removeTransactionFromDB; // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡πÑ‡∏î‡πâ

        // ********************** Export New Functions **********************
        window.saveRatesToDB = saveRatesToDB;
        window.loadRates = loadRates;
        window.saveCashToDB = saveCashToDB;
        window.loadCashBalance = loadCashBalance;
        // ************************************************************************


        // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î Transactions ‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏ô‡πâ‡∏≤
        loadTransactions((data) => {
            transactions = data;
            updateDashboard();
            applyLanguage(lang); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        });

        // ********************** New: Load Rates and Cash Balance **********************
        loadRates((data) => {
            rates = data;
            updateDashboard();
        });
        loadCashBalance((data) => {
            cashBalance = data;
            updateDashboard();
        });
        // ***********************************************************************************
    </script>


    <script>
        // ********************** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ß‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase **********************
        // const rates = { ... };
        let rates = {};

        // let cashBalance = { ... };
        let cashBalance = {};
        // *****************************************************************************************************

        // transactions ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Firebase ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î module
        let transactions = [];
        let lastTransaction = null;
        let lang = 'th'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 'th' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 'üåê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏•‡∏≤‡∏ß' ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢

        function showScreen(s) {
            dashboardScreen.classList.add("hidden");
            exchangeScreen.classList.add("hidden");
            transactionScreen.classList.add("hidden");

            if (s === "dashboard") updateDashboard();
            if (s === "exchange") renderForms();

            window[s + "Screen"].classList.remove("hidden");
        }

        // ********************** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á **********************
        function updateDashboard() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ rates ‡πÅ‡∏•‡∏∞ cashBalance ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            if (Object.keys(rates).length === 0 || Object.keys(cashBalance).length === 0) return;

            // ‡∏î‡∏∂‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô updateDashboard ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            rateTable.innerHTML = Object.keys(rates).map(p =>
                `<tr><td>${p}</td><td>${rates[p].buy.toLocaleString()}</td><td>${rates[p].sell.toLocaleString()}</td></tr>`
            ).join("");

            cashTable.innerHTML = Object.keys(cashBalance).map(c =>
                `<tr><td>${c}</td><td>${cashBalance[c].toLocaleString()}</td></tr>`
            ).join("");

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö
            transactionTable.innerHTML = transactions.slice().reverse().slice(0, 5).map(t =>
                `<tr>
                    <td>${t.time}</td>
                    <td>${t.type}</td>
                    <td>${t.pair}</td>
                    <td>${parseFloat(t.sourceAmount).toLocaleString()}</td>
                    <td>${parseFloat(t.targetAmount).toLocaleString()}</td>
                    <td><button class="delete-btn" onclick="removeTransaction('${t._id}')">‚ùå</button></td>
                </tr>`
            ).join("");
        }

        function calculateExchange() {
            const pair = currencyPair.value;
            const amt = parseFloat(sourceAmount.value);
            // ‡πÉ‡∏ä‡πâ Translations
            if (!amt || amt <= 0) return alert(translations[lang].alert_invalid_amount);
            if (rates[pair] === undefined) return alert(translations[lang].alert_no_rate); // ‡πÄ‡∏û‡∏¥‡πà‡∏° Alert

            // ‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ï‡∏£‡∏≤ 'Sell' ‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô)
            const rate = rates[pair].sell;
            const result = amt * rate;
            targetAmount.value = result.toFixed(2);

            const [from, to] = pair.split("-");
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Cash Balance: ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏≠ Source (‡πÄ‡∏û‡∏¥‡πà‡∏°), ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠ Target (‡∏•‡∏î)
            cashBalance[from] += amt;
            cashBalance[to] -= result;

            // ********************** FIX: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Cash Balance ‡∏•‡∏á Firebase **********************
            saveCashToDB(cashBalance);
            // ***********************************************************************************


            lastTransaction = {
                time: new Date().toLocaleString(),
                type: translations[lang].transaction_type, // ‡πÉ‡∏ä‡πâ Translations
                pair,
                sourceAmount: amt,
                targetAmount: result.toFixed(2)
            };

            // ********************** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á Firebase ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö ID **********************
            const txId = saveTransaction(lastTransaction);
            lastTransaction._id = txId; // ‡πÄ‡∏û‡∏¥‡πà‡∏° ID ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö lastTransaction
            transactions.push(lastTransaction);
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            transactionResult.innerHTML = translations[lang].alert_save_success;
            updateDashboard();

            // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å saveTransaction(lastTransaction) ‡∏ã‡πâ‡∏≥ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ó‡∏≥‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î module ‡πÅ‡∏•‡πâ‡∏ß
        }

        function printReceipt() {
            // ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            if (!lastTransaction) return alert(translations[lang].alert_no_receipt); // ‡πÉ‡∏ä‡πâ Translations

            receiptContent.innerHTML = `
                <p>${translations[lang].th_time}: ${lastTransaction.time}</p>
                <p>${translations[lang].lbl_pair}: ${lastTransaction.pair}</p>
                <p>${translations[lang].th_source_amt}: ${lastTransaction.sourceAmount.toLocaleString()}</p>
                <p>${translations[lang].th_target_amt}: ${lastTransaction.targetAmount.toLocaleString()}</p>
            `;

            printArea.classList.remove("hidden");
            window.print();
            printArea.classList.add("hidden");
        }

        function toggleTheme() {
            document.body.classList.toggle("dark");
        }

        function renderForms() {
            exchangeFormContainer.innerHTML = Object.keys(rates).map(p => `
                <label id="lbl_buy_${p}">${p} Buy</label>
                <input id="${p}-buy" type="number" step="any" value="${rates[p].buy}">
                <label id="lbl_sell_${p}">${p} Sell</label>
                <input id="${p}-sell" type="number" step="any" value="${rates[p].sell}">
                <button class="action" onclick="updateRate('${p}')" id="btn_rate_${p}">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏ó</button><hr>
            `).join("");

            cashFormContainer.innerHTML = Object.keys(cashBalance).map(cur => `
                <label id="lbl_cash_${cur}">${cur} Cash Balance</label>
                <input type="number" id="cash-${cur}" value="${cashBalance[cur]}">
                <button class="action" onclick="updateCash('${cur}')" id="btn_cash_${cur}">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î</button>
            `).join("");

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            applyExchangeFormsLang(lang);
        }

        function updateRate(pair) {
            const buyVal = parseFloat(document.getElementById(pair + "-buy").value);
            const sellVal = parseFloat(document.getElementById(pair + "-sell").value);

            if (isNaN(buyVal) || isNaN(sellVal)) {
                return alert(translations[lang].alert_invalid_number); // ‡πÉ‡∏ä‡πâ Translations
            }

            rates[pair].buy = buyVal;
            rates[pair].sell = sellVal;

            // ********************** FIX: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Rates ‡∏•‡∏á Firebase **********************
            saveRatesToDB(rates);
            // ************************************************************************

            alert(translations[lang].alert_rate_saved); // ‡πÉ‡∏ä‡πâ Translations
            // updateDashboard(); // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ã‡πâ‡∏≥ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ onValue listener ‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏á
        }

        function updateCash(cur) {
            cashBalance[cur] = parseFloat(document.getElementById("cash-" + cur).value);

            // ********************** FIX: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Cash Balance ‡∏•‡∏á Firebase **********************
            saveCashToDB(cashBalance);
            // ***********************************************************************************

            alert(translations[lang].alert_cash_updated); // ‡πÉ‡∏ä‡πâ Translations
            // updateDashboard(); // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ã‡πâ‡∏≥ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ onValue listener ‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏á
        }

        showScreen("dashboard"); // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å

        // ********************** ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏•‡∏∞ Firebase **********************
        window.removeTransaction = async function (txId) {
            // ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
            const confirmation = translations[lang].alert_confirm_delete;
            if (confirm(confirmation)) {
                try {
                    // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Firebase (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î module)
                    await removeTransactionFromDB(txId);

                    // ‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Array
                    transactions = transactions.filter(t => t._id !== txId);

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤ Dashboard
                    updateDashboard();

                } catch (error) {
                    console.error("Error removing transaction: ", error);
                    alert(translations[lang].alert_delete_error); // ‡πÉ‡∏ä‡πâ Translations
                }
            }
        }

        // =================================== ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÉ‡∏´‡∏°‡πà (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö TH, LO, EN) ===================================
        const translations = {
            th: {
                header_text: "üíµ ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏Å‡πÄ‡∏á‡∏¥‡∏ô - Fuji Mobile Shop",
                nav_dashboard: "üìä ‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô",
                nav_exchange: "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ôüîÑ",
                nav_transaction: "üìà ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÄ‡∏á‡∏¥‡∏ô",
                dashboard_title: "Dashboard",
                rate_table_title: "üí± ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô",
                th_pair: "‡∏Ñ‡∏π‡πà‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô", th_buy: "‡∏ã‡∏∑‡πâ‡∏≠ ", th_sell: "‡∏Ç‡∏≤‡∏¢",
                cash_table_title: "üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠", th_currency: "‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô", th_balance: "‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠",
                transaction_table_title: "üìù ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î", th_time: "‡πÄ‡∏ß‡∏•‡∏≤", th_type: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó", th_pair_tx: "‡∏Ñ‡∏π‡πà", th_source_amt: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ", th_target_amt: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö", th_delete: "‡∏•‡∏ö",
                btn_export_pdf: "üìÑ Export PDF Report", btn_export_excel: "üìä Export Excel",
                exchange_title: "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏±‡∏ï‡∏£‡∏≤", cash_edit_title: "üí∞ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Cash Balance",
                transaction_main_title: "‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÄ‡∏á‡∏¥‡∏ô", lbl_pair: "‡∏Ñ‡∏π‡πà‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô", lbl_source: "‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ", lbl_target: "‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö",
                btn_calculate: "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å", btn_receipt: "üßæ ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à", receipt_title: "‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô", receipt_footer: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£",
                lang_switch: "üåê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏•‡∏≤‡∏ß",
                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡∏£‡∏≤/‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠
                exchange_rate_buy: "‡∏ã‡∏∑‡πâ‡∏≠", exchange_rate_sell: "‡∏Ç‡∏≤‡∏¢", exchange_btn_rate: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏ó",
                exchange_cash_balance: "‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠", exchange_btn_cash: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î",
                // Alerts & Messages
                alert_invalid_amount: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", alert_no_rate: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ô‡∏µ‡πâ", alert_invalid_number: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", alert_rate_saved: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏ó‡πÅ‡∏•‡πâ‡∏ß", alert_cash_updated: "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡πâ‡∏ß", alert_save_success: "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", alert_no_receipt: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå",
                alert_confirm_delete: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?", alert_delete_error: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£", transaction_type: "‡πÅ‡∏•‡∏Å‡πÄ‡∏á‡∏¥‡∏ô"
            },
            lo: {
                header_text: "üíµ ‡∫•‡∫∞‡∫ö‡∫ª‡∫ö‡ªÅ‡∫•‡∫Å‡∫õ‡ªà‡∫Ω‡∫ô‡∫û‡∫≤‡∫ç‡ªÉ‡∫ô‡∫Æ‡ªâ‡∫≤‡∫ô - Fuji Mobile Shop",
                nav_dashboard: "üìä ‡ªú‡ªâ‡∫≤‡∫≠‡∫±‡∫î‡∫ï‡∫≤‡ªÅ‡∫•‡∫Å‡∫õ‡ªà‡∫Ω‡∫ô",
                nav_exchange: "‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç‡∫≠‡∫±‡∫î‡∫ï‡∫≤‡ªÅ‡∫•‡∫Å‡∫õ‡ªà‡∫Ω‡∫ôüîÑ",
                nav_transaction: "üìà ‡ªÄ‡∫Æ‡∫±‡∫î‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡ªÅ‡∫•‡∫Å‡∫õ‡ªà‡∫Ω‡∫ô",
                dashboard_title: "Dashboard",
                rate_table_title: "üí± ‡∫≠‡∫±‡∫î‡∫ï‡∫≤‡ªÅ‡∫•‡∫Å‡∫õ‡ªà‡∫Ω‡∫ô‡∫õ‡∫∞‡∫à‡∫≥‡∫ß‡∫±‡∫ô",
                th_pair: "‡∫Ñ‡∫π‡ªà‡∫™‡∫∞‡∫Å‡∫∏‡∫ô‡ªÄ‡∫á‡∫¥‡∫ô", th_buy: "‡∫ä‡∫∑‡ªâ ", th_sell: "‡∫Ç‡∫≤‡∫ç ",
                cash_table_title: "üí∞ ‡∫ç‡∫≠‡∫î‡ªÄ‡∫á‡∫¥‡∫ô‡∫Ñ‡∫ª‡∫á‡ªÄ‡∫´‡∫º‡∫∑‡∫≠", th_currency: "‡∫™‡∫∞‡∫Å‡∫∏‡∫ô‡ªÄ‡∫á‡∫¥‡∫ô", th_balance: "‡∫ç‡∫≠‡∫î‡∫Ñ‡∫ª‡∫á‡ªÄ‡∫´‡∫º‡∫∑‡∫≠",
                transaction_table_title: "üìù ‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡ªÅ‡∫•‡∫Å‡∫õ‡ªà‡∫Ω‡∫ô‡∫•‡ªà‡∫≤‡∫™‡∫∏‡∫î", th_time: "‡ªÄ‡∫ß‡∫•‡∫≤", th_type: "‡∫õ‡∫∞‡ªÄ‡∫û‡∫î", th_pair_tx: "‡∫Ñ‡∫π‡ªà", th_source_amt: "‡∫à‡∫≥‡∫ô‡∫ß‡∫ô‡∫ó‡∫µ‡ªà‡ªÉ‡∫´‡ªâ", th_target_amt: "‡∫à‡∫≥‡∫ô‡∫ß‡∫ô‡∫ó‡∫µ‡ªà‡ªÑ‡∫î‡ªâ‡∫Æ‡∫±‡∫ö", th_delete: "‡∫•‡∫∂‡∫ö",
                btn_export_pdf: "üìÑ ‡∫™‡∫ª‡ªà‡∫á‡∫≠‡∫≠‡∫Å‡∫•‡∫≤‡∫ç‡∫á‡∫≤‡∫ô PDF", btn_export_excel: "üìä ‡∫™‡∫ª‡ªà‡∫á‡∫≠‡∫≠‡∫Å Excel",
                exchange_title: "‡∫ï‡∫±‡ªâ‡∫á‡∫Ñ‡ªà‡∫≤‡∫≠‡∫±‡∫î‡∫ï‡∫≤", cash_edit_title: "üí∞ ‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç‡∫ç‡∫≠‡∫î‡ªÄ‡∫á‡∫¥‡∫ô‡∫Ñ‡∫ª‡∫á‡ªÄ‡∫´‡∫º‡∫∑‡∫≠",
                transaction_main_title: "‡ªÄ‡∫Æ‡∫±‡∫î‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡ªÅ‡∫•‡∫Å‡∫õ‡ªà‡∫Ω‡∫ô", lbl_pair: "‡∫Ñ‡∫π‡ªà‡∫™‡∫∞‡∫Å‡∫∏‡∫ô‡ªÄ‡∫á‡∫¥‡∫ô", lbl_source: "‡ªÄ‡∫á‡∫¥‡∫ô‡∫ó‡∫µ‡ªà‡∫•‡∫π‡∫Å‡∫Ñ‡ªâ‡∫≤‡ªÉ‡∫´‡ªâ", lbl_target: "‡ªÄ‡∫á‡∫¥‡∫ô‡∫ó‡∫µ‡ªà‡ªÑ‡∫î‡ªâ‡∫Æ‡∫±‡∫ö",
                btn_calculate: "‡∫Ñ‡∫≥‡∫ô‡∫ß‡∫ô‡ªÅ‡∫•‡∫∞‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å", btn_receipt: "üßæ ‡∫û‡∫¥‡∫°‡ªÉ‡∫ö‡ªÄ‡∫Å‡∫±‡∫ö‡ªÄ‡∫á‡∫¥‡∫ô", receipt_title: "‡ªÉ‡∫ö‡∫Æ‡∫±‡∫ö‡ªÄ‡∫á‡∫¥‡∫ô", receipt_footer: "‡∫Ç‡∫≠‡∫ö‡ªÉ‡∫à‡∫ó‡∫µ‡ªà‡ªÉ‡∫ä‡ªâ‡∫ö‡ªç‡∫•‡∫¥‡∫Å‡∫≤‡∫ô",
                lang_switch: "üåê ‡∫õ‡ªà‡∫Ω‡∫ô‡ªÄ‡∫õ‡∫±‡∫ô English", // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô English
                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡∏£‡∏≤/‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠
                exchange_rate_buy: "‡∫ä‡∫∑‡ªâ", exchange_rate_sell: "‡∫Ç‡∫≤‡∫ç", exchange_btn_rate: "‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫≠‡∫±‡∫î‡∫ï‡∫≤",
                exchange_cash_balance: "‡∫ç‡∫≠‡∫î‡∫Ñ‡∫ª‡∫á‡ªÄ‡∫´‡∫º‡∫∑‡∫≠", exchange_btn_cash: "‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫ç‡∫≠‡∫î",
                // Alerts & Messages
                alert_invalid_amount: "‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡ªÉ‡∫™‡ªà‡∫à‡∫≥‡∫ô‡∫ß‡∫ô‡ªÄ‡∫á‡∫¥‡∫ô‡∫ó‡∫µ‡ªà‡∫ñ‡∫∑‡∫Å‡∫ï‡ªâ‡∫≠‡∫á", alert_no_rate: "‡∫ö‡ªç‡ªà‡∫û‡∫ª‡∫ö‡∫≠‡∫±‡∫î‡∫ï‡∫≤‡ªÅ‡∫•‡∫Å‡∫õ‡ªà‡∫Ω‡∫ô‡∫™‡∫≥‡∫•‡∫±‡∫ö‡∫Ñ‡∫π‡ªà‡∫ô‡∫µ‡ªâ", alert_invalid_number: "‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡ªÉ‡∫™‡ªà‡∫ï‡∫ª‡∫ß‡ªÄ‡∫•‡∫Å‡∫ó‡∫µ‡ªà‡∫ñ‡∫∑‡∫Å‡∫ï‡ªâ‡∫≠‡∫á", alert_rate_saved: "‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫≠‡∫±‡∫î‡∫ï‡∫≤‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß", alert_cash_updated: "‡∫≠‡∫±‡∫ö‡ªÄ‡∫î‡∫î‡∫ç‡∫≠‡∫î‡ªÄ‡∫á‡∫¥‡∫ô‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß", alert_save_success: "‚úÖ ‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß", alert_no_receipt: "‡∫ç‡∫±‡∫á‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡ªÉ‡∫´‡ªâ‡∫û‡∫¥‡∫°",
                alert_confirm_delete: "‡∫ó‡ªà‡∫≤‡∫ô‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫•‡∫∂‡∫ö‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡ªÅ‡∫•‡∫Å‡∫õ‡ªà‡∫Ω‡∫ô‡∫ô‡∫µ‡ªâ ‡∫´‡∫º‡∫∑ ‡∫ö‡ªç‡ªà?", alert_delete_error: "‡ªÄ‡∫Å‡∫µ‡∫î‡∫Ç‡ªç‡ªâ‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î‡ªÉ‡∫ô‡∫Å‡∫≤‡∫ô‡∫•‡∫∂‡∫ö‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô", transaction_type: "‡ªÅ‡∫•‡∫Å‡∫õ‡ªà‡∫Ω‡∫ô"
            },
            en: { // ********************** ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© **********************
                header_text: "üíµ Exchange System - Fuji Mobile Shop",
                nav_dashboard: "üìä Exchange Rates",
                nav_exchange: "Edit Rates üîÑ",
                nav_transaction: "üìà Make Transaction",
                dashboard_title: "Dashboard",
                rate_table_title: "üí± Daily Exchange Rates",
                th_pair: "Currency Pair", th_buy: "Buy ", th_sell: "Sell",
                cash_table_title: "üí∞ Cash Balance", th_currency: "Currency", th_balance: "Balance",
                transaction_table_title: "üìù Latest Transactions", th_time: "Time", th_type: "Type", th_pair_tx: "Pair", th_source_amt: "Amount Given", th_target_amt: "Amount Received", th_delete: "Delete",
                btn_export_pdf: "üìÑ Export PDF Report", btn_export_excel: "üìä Export Excel",
                exchange_title: "Set Exchange Rates", cash_edit_title: "üí∞ Edit Cash Balance",
                transaction_main_title: "Make Exchange Transaction", lbl_pair: "Currency Pair", lbl_source: "Customer Gives", lbl_target: "Customer Receives",
                btn_calculate: "Calculate and Save", btn_receipt: "üßæ Print Receipt", receipt_title: "Receipt", receipt_footer: "Thank you for your service",
                lang_switch: "üåê Change to Thai", // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢
                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡∏£‡∏≤/‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠
                exchange_rate_buy: "Buy", exchange_rate_sell: "Sell", exchange_btn_rate: "Save Rate",
                exchange_cash_balance: "Cash Balance", exchange_btn_cash: "Save Balance",
                // Alerts & Messages
                alert_invalid_amount: "Please enter a valid amount", alert_no_rate: "No rate found for this pair", alert_invalid_number: "Please enter a valid number", alert_rate_saved: "Rate saved successfully", alert_cash_updated: "Cash balance updated", alert_save_success: "‚úÖ Saved successfully", alert_no_receipt: "No transaction to print",
                alert_confirm_delete: "Do you want to delete this transaction?", alert_delete_error: "Error deleting transaction", transaction_type: "Exchange"
            }
        };

        function applyLanguage(currentLang) {
            const t = translations[currentLang];
            // Update text for elements with specific IDs
            document.getElementById('header_text').innerText = t.header_text;
            document.getElementById('nav_dashboard').innerText = t.nav_dashboard;
            document.getElementById('nav_exchange').innerText = t.nav_exchange;
            document.getElementById('nav_transaction').innerText = t.nav_transaction;
            document.getElementById('lang_switch').innerText = t.lang_switch;

            // Dashboard
            document.getElementById('dashboard_title').innerText = t.dashboard_title;
            document.getElementById('rate_table_title').innerText = t.rate_table_title;
            document.getElementById('th_pair').innerText = t.th_pair;
            document.getElementById('th_buy').innerText = t.th_buy;
            document.getElementById('th_sell').innerText = t.th_sell;
            document.getElementById('cash_table_title').innerText = t.cash_table_title;
            document.getElementById('th_currency').innerText = t.th_currency;
            document.getElementById('th_balance').innerText = t.th_balance;
            document.getElementById('transaction_table_title').innerText = t.transaction_table_title;
            document.getElementById('th_time').innerText = t.th_time;
            document.getElementById('th_type').innerText = t.th_type;
            document.getElementById('th_pair_tx').innerText = t.th_pair_tx;
            document.getElementById('th_source_amt').innerText = t.th_source_amt;
            document.getElementById('th_target_amt').innerText = t.th_target_amt;
            document.getElementById('th_delete').innerText = t.th_delete;
            document.getElementById('btn_export_pdf').innerText = t.btn_export_pdf;
            document.getElementById('btn_export_excel').innerText = t.btn_export_excel;
            // Title Tag for Lao/Others
            const titleText = currentLang === 'lo' ? "üíµ ‡∫•‡∫∞‡∫ö‡∫ª‡∫ö‡ªÅ‡∫•‡∫Å‡∫õ‡ªà‡∫Ω‡∫ô‡∫û‡∫≤‡∫ç‡ªÉ‡∫ô‡∫Æ‡ªâ‡∫≤‡∫ô - ‡∫ô‡∫≤‡∫á‡∫õ‡∫≤‡∫ä‡ªâ‡∫≠‡∫ç‡∫ä‡∫ª‡ªà‡∫á" : t.header_text;
            document.getElementById('title_header_lo').innerText = titleText;


            // Exchange Screen
            document.getElementById('exchange_title').innerText = t.exchange_title;
            document.getElementById('cash_edit_title').innerText = t.cash_edit_title;
            applyExchangeFormsLang(currentLang);


            // Transaction Screen
            document.getElementById('transaction_main_title').innerText = t.transaction_main_title;
            document.getElementById('lbl_pair').innerText = t.lbl_pair;
            document.getElementById('lbl_source').innerText = t.lbl_source;
            document.getElementById('lbl_target').innerText = t.lbl_target;
            document.getElementById('btn_calculate').innerText = t.btn_calculate;
            document.getElementById('btn_receipt').innerText = t.btn_receipt;
            document.getElementById('receipt_title').innerText = t.receipt_title;
            document.getElementById('receipt_footer').innerText = t.receipt_footer;
        }

        function applyExchangeFormsLang(currentLang) {
            const t = translations[currentLang];
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡∏£‡∏≤
            Object.keys(rates).forEach(p => {
                const lblBuy = document.getElementById(`lbl_buy_${p}`);
                const lblSell = document.getElementById(`lbl_sell_${p}`);
                const btnRate = document.getElementById(`btn_rate_${p}`);
                if (lblBuy) lblBuy.innerText = `${p} ${t.exchange_rate_buy}`;
                if (lblSell) lblSell.innerText = `${p} ${t.exchange_rate_sell}`;
                if (btnRate) btnRate.innerText = t.exchange_btn_rate;
            });

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠
            Object.keys(cashBalance).forEach(cur => {
                const lblCash = document.getElementById(`lbl_cash_${cur}`);
                const btnCash = document.getElementById(`btn_cash_${cur}`);
                if (lblCash) lblCash.innerText = `${cur} ${t.exchange_cash_balance}`;
                if (btnCash) btnCash.innerText = t.exchange_btn_cash;
            });
        }


        window.toggleLang = function () {
            // ‡∏™‡∏•‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤: ‡πÑ‡∏ó‡∏¢ (th) -> ‡∏•‡∏≤‡∏ß (lo) -> ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© (en) -> ‡πÑ‡∏ó‡∏¢ (th)
            if (lang === 'th') {
                lang = 'lo';
            } else if (lang === 'lo') {
                lang = 'en';
            } else {
                lang = 'th';
            }
            applyLanguage(lang);
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
        applyLanguage(lang);
    </script>
</body>

</html>
